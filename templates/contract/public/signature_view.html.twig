{% extends 'layouts/dashboard.html.twig' %}

{% block title %}Signature - Contract {{ contract.contractNumber }}{% endblock %}
{% block breadcrumb %}Public / Signature / {{ contract.contractNumber }}{% endblock %}
{% block page_title %}Partner Signature Page{% endblock %}

{% block body %}
<div class="flex flex-wrap -mx-3">
    <!-- Main Content (Document Preview) -->
    <div class="w-full max-w-full px-3 lg:w-8/12">
        <div class="relative flex flex-col min-w-0 mb-6 break-words bg-white border-0 shadow-soft-xl rounded-2xl bg-clip-border h-full">
            <div class="p-6 border-b flex justify-between items-center bg-gray-50/50 rounded-t-2xl">
                <div>
                    <h6 class="mb-0 font-bold">Contract Review</h6>
                    <p class="text-xs mb-0 text-slate-400">Please review the details below before signing</p>
                </div>
                <div class="text-right">
                    <span class="bg-white border px-3 py-1 rounded-pill text-xs font-bold text-slate-500 shadow-soft-xxs">
                        REF: {{ contract.contractNumber }}
                    </span>
                </div>
            </div>
            <div class="flex-auto p-6 bg-slate-50/30 rounded-b-2xl">
                <!-- Contract Visual Container (The "Paper") -->
                <div class="max-w-[750px] mx-auto bg-white shadow-soft-2xl border-gray-100 border rounded-sm min-h-[1000px] p-16 md:p-20 flex flex-col relative overflow-hidden">
                    <!-- Decorative Corner -->
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-fuchsia-50/50 to-transparent -mr-16 -mt-16 rounded-full"></div>
                    
                    <!-- Header -->
                    <div class="flex justify-between items-start border-b border-gray-100 pb-8 mb-12 relative z-10">
                        <div>
                            <div class="flex items-center mb-2">
                                <img src="{{ asset('assets/img/logo-ct.png') }}" class="h-8 mr-3 opacity-80" alt="logo">
                                <h2 class="text-lg font-bold uppercase text-slate-700 tracking-tight mb-0">Service Contract</h2>
                            </div>
                            <p class="text-[10px] text-slate-400 font-mono tracking-tighter uppercase px-1">Digital Protocol #{{ contract.contractNumber }}</p>
                        </div>
                        <div class="text-right">
                            <h6 class="text-xs font-bold text-slate-500 mb-0">CreaCo Ecosystem</h6>
                            <p class="text-[10px] text-slate-400 mb-0 uppercase tracking-widest">Issuance Date</p>
                            <p class="text-xs font-bold text-slate-600">{{ contract.createdAt|date('d/m/Y') }}</p>
                        </div>
                    </div>
                    
                    <!-- Parties Involved -->
                    <div class="grid grid-cols-2 gap-12 mb-12 relative z-10">
                        <div class="p-4 bg-gray-50/50 rounded-xl border border-gray-100">
                            <h6 class="text-[10px] font-bold uppercase text-slate-400 mb-2 tracking-widest border-b border-gray-200 pb-1">The Provider (You)</h6>
                            <p class="text-sm font-bold text-slate-700 mb-0">{{ contract.collabRequest.collaborator.companyName }}</p>
                            <p class="text-xs text-slate-500 mb-0">Representative: {{ contract.collaborator.name|default('Official Partner') }}</p>
                            <p class="text-xs text-slate-400 italic">Validated Partner Entity</p>
                        </div>
                        <div class="p-4 bg-gray-50/50 rounded-xl border border-gray-100">
                            <h6 class="text-[10px] font-bold uppercase text-slate-400 mb-2 tracking-widest border-b border-gray-200 pb-1">The Client / Emitter</h6>
                            <p class="text-sm font-bold text-slate-700 mb-0">{{ contract.collabRequest.creator ? contract.collabRequest.creator.username : 'CreaCo Internal' }}</p>
                            <p class="text-xs text-slate-500 mb-0">Platform Content Curator</p>
                            <p class="text-xs text-slate-400 italic">CreaCo Verified Account</p>
                        </div>
                    </div>

                    <!-- Contract Core Body -->
                    <div class="space-y-10 relative z-10">
                        <!-- Object Section -->
                        <section>
                            <h6 class="text-[11px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-4 flex items-center">
                                <span class="w-8 h-[1px] bg-slate-200 mr-3"></span> Object of the Contract
                            </h6>
                            <div class="pl-11">
                                <p class="text-sm text-slate-600 leading-relaxed mb-3">The object of this contract is the realization of the following mission: <span class="font-bold text-slate-700">{{ contract.collabRequest.title }}</span>.</p>
                                <div class="text-[11px] leading-relaxed text-slate-500 p-4 bg-slate-50/50 rounded border border-slate-100 italic shadow-soft-xxs">
                                    {{ contract.collabRequest.description }}
                                </div>
                            </div>
                        </section>

                        <!-- Terms & Financials -->
                        <div class="grid grid-cols-2 gap-10">
                            <section>
                                <h6 class="text-[11px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-4 flex items-center">
                                    <span class="w-8 h-[1px] bg-slate-200 mr-3"></span> Duration Period
                                </h6>
                                <div class="pl-11 space-y-1">
                                    <div class="flex justify-between text-xs">
                                        <span class="text-slate-400">Effective from:</span>
                                        <span class="font-bold text-slate-700">{{ contract.collabRequest.startDate|date('d/m/Y') }}</span>
                                    </div>
                                    <div class="flex justify-between text-xs">
                                        <span class="text-slate-400">Terminating on:</span>
                                        <span class="font-bold text-slate-700">{{ contract.collabRequest.endDate|date('d/m/Y') }}</span>
                                    </div>
                                </div>
                            </section>
                            <section>
                                <h6 class="text-[11px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-4 flex items-center">
                                    <span class="w-8 h-[1px] bg-slate-200 mr-3"></span> Financial Commitment
                                </h6>
                                <div class="pl-11">
                                    <p class="text-2xl font-bold text-slate-800 mb-0">{{ contract.collabRequest.budget|number_format(2, '.', ' ') }} <span class="text-xs font-normal text-slate-400">DT</span></p>
                                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">Total Contractual Amount</p>
                                </div>
                            </section>
                        </div>

                        <!-- Footer / Signatures -->
                        <div class="mt-auto pt-20 grid grid-cols-2 gap-20 relative z-10">
                            <div class="border-t border-gray-100 pt-4">
                                <p class="text-[9px] font-bold uppercase text-slate-300 mb-4 tracking-[0.3em]">CLIENT VISA</p>
                                <div class="h-12 flex items-center">
                                    <div class="text-[11px] font-bold text-slate-400 flex items-center py-1 px-3 border border-slate-100 rounded-lg bg-slate-50/30">
                                        <i class="ni ni-check-bold text-green-400 mr-2"></i>
                                        DIGITALLY VALIDATED
                                    </div>
                                </div>
                            </div>
                            <div class="border-t border-gray-100 pt-4 text-right">
                                <p class="text-[9px] font-bold uppercase text-slate-300 mb-4 tracking-[0.3em]">PROVIDER VISA</p>
                                <div class="h-12 flex items-center justify-end">
                                    {% if contract.signedByCollaborator %}
                                        <div class="px-3 py-2 border-2 border-fuchsia-100 rounded rotate-1 bg-fuchsia-50/20 shadow-soft-xs">
                                            <p class="text-[10px] font-bold text-fuchsia-500 mb-0 leading-tight uppercase">ELECTRONICALLY SIGNED</p>
                                            <p class="text-[8px] text-fuchsia-400 mb-0 font-mono">{{ contract.collaboratorSignatureDate|date('d/m/Y H:i') }}</p>
                                        </div>
                                    {% else %}
                                        <p class="text-xs text-slate-300 italic mb-0">Awaiting your signature...</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Side Panel (Validation Center) -->
    <div class="w-full max-w-full px-3 lg:w-4/12">
        <div class="relative flex flex-col min-w-0 mb-6 break-words bg-white border-0 shadow-soft-xl rounded-2xl bg-clip-border h-full">
            <div class="p-6">
                <div class="flex items-center mb-6">
                    <div class="bg-gradient-to-tl from-purple-700 to-pink-500 p-2 rounded-lg mr-3 shadow-soft-md">
                        <i class="ni ni-check-bold text-white text-xs"></i>
                    </div>
                    <h6 class="mb-0 font-bold">Validation Center</h6>
                </div>
                
                {% if contract.signedByCollaborator %}
                    <div class="p-8 text-center bg-gradient-to-tr from-green-50 to-white rounded-2xl border border-green-100 shadow-soft-xxs">
                        <div class="w-16 h-16 mx-auto mb-6 bg-white rounded-full shadow-soft-md flex items-center justify-center">
                            <i class="ni ni-like-2 text-green-500 text-xl"></i>
                        </div>
                        <h5 class="text-slate-800 font-bold mb-2">Process Complete</h5>
                        <p class="text-xs text-slate-500 mb-0 leading-relaxed">
                            Thank you! Your digital signature was successfully recorded on <strong>{{ contract.collaboratorSignatureDate|date('d/m/Y') }}</strong> at <strong>{{ contract.collaboratorSignatureDate|date('H:i') }}</strong>.
                        </p>
                    </div>
                {% else %}
                    <p class="text-xs text-slate-500 mb-8 leading-relaxed">
                        By applying your digital signature, you formally acknowledge and accept all terms, conditions, and deliverables specified in this document.
                    </p>
                    
                    <form action="{{ path('app_public_contract_sign_submit', {contractNumber: contract.contractNumber, token: contract.signatureToken}) }}" method="POST">
                        <button type="submit" class="inline-block w-full px-6 py-4 font-bold text-center text-white uppercase align-middle transition-all bg-transparent border-0 rounded-xl cursor-pointer shadow-soft-md bg-x-25 bg-150 leading-pro text-xs ease-soft-in tracking-tight-soft bg-gradient-to-tl from-purple-700 to-pink-500 hover:scale-[1.02] hover:shadow-soft-lg active:opacity-85">
                            <i class="ni ni-pen-01 mr-2"></i> Confirm My Signature
                        </button>
                    </form>

                    <!-- Trust Statement -->
                    <div class="mt-10 p-5 rounded-2xl border border-dashed border-gray-200 bg-gray-50/30">
                        <div class="flex items-center mb-3">
                            <i class="ni ni-lock-circle-open text-slate-400 mr-2 text-xs"></i>
                            <h6 class="text-[10px] font-bold text-slate-400 uppercase mb-0 tracking-widest">Secure Protocol</h6>
                        </div>
                        <p class="text-[10px] text-slate-400 leading-tight mb-0">
                            This transaction is protected by CreaCo's digital protocol. Your signature is cryptographically linked to your partner account.
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
