{% extends 'base.html.twig' %}

{% block title %}Events{% endblock %}
{% block page_title %}Events{% endblock %}

{% block body %}
<div class="flex flex-wrap -mx-3">
    <div class="flex-none w-full max-w-full px-3">
        <div class="relative flex flex-col min-w-0 mb-6 break-words bg-white border-0 border-transparent border-solid shadow-soft-xl rounded-2xl bg-clip-border">
            <div class="p-6 pb-0 mb-0 bg-white border-b-0 border-b-solid rounded-t-2xl border-b-transparent">
                <div class="flex justify-between items-center px-4 py-2 bg-gray-50 rounded-xl mb-4 mx-6">
                    <div class="flex items-center space-x-4">
                        <div class="flex flex-col">
                            <label class="text-xxs font-bold text-slate-400 mb-1 uppercase">Filter by Category</label>
                            <select id="filter-category" class="text-xs focus:shadow-soft-primary-outline rounded-lg border border-gray-300 px-2 py-1 outline-none">
                                <option value="all">All Categories</option>
                                <option value="course">Course</option>
                                <option value="meeting">Meeting</option>
                                <option value="workshop">Workshop</option>
                            </select>
                        </div>
                        <div class="flex flex-col">
                            <label class="text-xxs font-bold text-slate-400 mb-1 uppercase">Filter by Type</label>
                            <select id="filter-type" class="text-xs focus:shadow-soft-primary-outline rounded-lg border border-gray-300 px-2 py-1 outline-none">
                                <option value="all">All Types</option>
                                <option value="online">Online</option>
                                <option value="in-person">In-person</option>
                            </select>
                        </div>
                        <div class="flex flex-col">
                            <label class="text-xxs font-bold text-slate-400 mb-1 uppercase">Search</label>
                            <input type="text" id="search-event" placeholder="Search by name..." class="text-xs focus:shadow-soft-primary-outline rounded-lg border border-gray-300 px-2 py-1 outline-none">
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="mb-0 text-xs text-slate-400">Showing <span id="visible-count" class="font-bold text-slate-700">{{ events|length }}</span> events</p>
                    </div>
                </div>

                <div class="flex justify-between items-center px-6">
                    <h6 class="font-bold">All Events</h6>
                    <a href="{{ path('event_new') }}" class="inline-block px-6 py-3 font-bold text-center text-white uppercase align-middle transition-all bg-transparent border-0 rounded-lg cursor-pointer leading-pro text-xs ease-soft-in shadow-soft-md bg-150 bg-x-25 bg-gradient-to-tl from-purple-700 to-pink-500 hover:shadow-soft-2xl hover:scale-102">Create New Event</a>
                </div>
            </div>
            <div class="flex-auto px-0 pt-0 pb-2">
                <div class="p-0 overflow-x-auto">
                    <table class="items-center w-full mb-0 align-top border-gray-200 text-slate-500">
                        <thead class="align-bottom">
                            <tr>
                                <th class="px-6 py-3 font-bold text-left uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Event</th>
                                <th class="px-6 py-3 pl-2 font-bold text-left uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Category</th>
                                <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Date</th>
                                <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Type</th>
                                <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Participants</th>
                                <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">New Requests</th>
                                <th class="px-6 py-3 font-semibold capitalize align-middle bg-transparent border-b border-gray-200 border-b-solid shadow-none tracking-none whitespace-nowrap text-slate-400 opacity-70">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in events %}
                            <tr class="event-row" data-category="{{ event.category }}" data-type="{{ event.type }}" data-name="{{ event.name|lower }}">
                                <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <div class="flex px-2 py-1">
                                        <div class="flex flex-col justify-center">
                                            <h6 class="mb-0 text-sm leading-normal">{{ event.name }}</h6>
                                            <p class="mb-0 text-xs leading-tight text-slate-400">{{ event.organizer }}</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <p class="mb-0 text-xs font-semibold leading-tight capitalize">{{ event.category }}</p>
                                </td>
                                <td class="p-2 text-center align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <span class="text-xs font-semibold leading-tight text-slate-400">{{ event.date|date('Y-m-d') }} {{ event.time|date('H:i') }}</span>
                                </td>
                                 <td class="p-2 text-center align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <span class="bg-gradient-to-tl {{ event.type == 'online' ? 'from-green-600 to-lime-400' : 'from-blue-600 to-cyan-400' }} px-2.5 text-xs rounded-1.8 py-1.4 inline-block whitespace-nowrap text-center align-baseline font-bold uppercase leading-none text-white">{{ event.type }}</span>
                                </td>
                                <td class="p-2 text-center align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <span class="text-xs font-semibold leading-tight {% if event.validatedReservationsCount >= event.capacity and event.capacity > 0 %}text-red-600{% else %}text-slate-400{% endif %}">
                                        {{ event.validatedReservationsCount }}{% if event.capacity %} / {{ event.capacity }}{% endif %}
                                    </span>
                                </td>
                                 <td class="p-2 text-center align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <span class="inline-flex items-center justify-center w-8 h-8 text-xs font-bold leading-none text-white rounded-full bg-gradient-to-tl {% if event.pendingReservationsCount > 0 %}from-purple-700 to-pink-500 shadow-soft-md{% else %}from-slate-600 to-slate-200{% endif %}">
                                        {{ event.pendingReservationsCount }}
                                    </span>
                                </td>


<<<<<<< HEAD
                                 <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                <a href="{{ path('event_show', {'id': event.id}) }}" class="mr-4 text-xs font-semibold leading-tight text-slate-400 hover:text-blue-600 transition-all">
                                    <i class="fa fa-eye mr-1"></i> View
                                </a>

                                <a href="{{ path('event_edit', {'id': event.id}) }}" class="mr-4 text-xs font-semibold leading-tight text-slate-400 hover:text-orange-500 transition-all">
                                    <i class="fa fa-edit mr-1"></i> Edit
                                </a>

                                <a href="{{ path('event_manage', {'id': event.id}) }}" class="mr-4 text-xs font-semibold leading-tight text-slate-400 hover:text-purple-600 transition-all">
                                    <i class="fa fa-users-cog mr-1"></i> Manage
                                </a>

                                <a href="javascript:void(0)" onclick="confirmDelete('{{ path('event_delete', {'id': event.id}) }}', '{{ event.name|e('js') }}')" class="text-xs font-semibold leading-tight text-red-600 hover:text-red-800 transition-all">
                                    <i class="fa fa-trash mr-1"></i> Delete
                                </a>
                            </td>



                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="7" class="text-center p-4">No events found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
function confirmDelete(deleteUrl, eventName) {
    Swal.fire({
        title: 'Are you sure?',
        text: "You are about to delete '" + eventName + "'. This action cannot be undone!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#cb0c9f',
        cancelButtonColor: '#8392ab',
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'Cancel',
        reverseButtons: true
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = deleteUrl;
        }
    })
}

// --- Filtering Logic ---
document.addEventListener('DOMContentLoaded', function() {
    const categoryFilter = document.getElementById('filter-category');
    const typeFilter = document.getElementById('filter-type');
    const searchInput = document.getElementById('search-event');
    const rows = document.querySelectorAll('.event-row');
    const visibleCount = document.getElementById('visible-count');

    function filterEvents() {
        const selectedCategory = categoryFilter.value;
        const selectedType = typeFilter.value;
        const searchQuery = searchInput ? searchInput.value.toLowerCase() : '';
        let count = 0;

        rows.forEach(row => {
            const category = row.dataset.category;
            const type = row.dataset.type;
            const name = row.dataset.name;

            const categoryMatch = (selectedCategory === 'all' || category === selectedCategory);
            const typeMatch = (selectedType === 'all' || type === selectedType);
            const searchMatch = (name.includes(searchQuery));

            if (categoryMatch && typeMatch && searchMatch) {
                row.style.display = '';
                count++;
            } else {
                row.style.display = 'none';
            }
        });

        if (visibleCount) visibleCount.textContent = count;
    }

    if (categoryFilter) categoryFilter.addEventListener('change', filterEvents);
    if (typeFilter) typeFilter.addEventListener('change', filterEvents);
    if (searchInput) searchInput.addEventListener('input', filterEvents);
});
</script>
<<<<<<< HEAD
{% endblock %}
=======
{% endblock %}
>>>>>>> 2961df0841d6f673480afb7b0dfc901c4bdf7bd8
