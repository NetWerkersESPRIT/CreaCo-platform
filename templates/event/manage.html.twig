{% extends 'base.html.twig' %}

{% block title %}Manage Reservations{% endblock %}
{% block page_title %}Manage Reservations for {{ event.name }}{% endblock %}

{% block body %}
<div class="flex flex-wrap -mx-3">
    <div class="flex-none w-full max-w-full px-3">
        <div class="relative flex flex-col min-w-0 mb-6 break-words bg-white border-0 border-transparent border-solid shadow-soft-xl rounded-2xl bg-clip-border">
            <div class="p-6 pb-0 mb-0 bg-white border-b-0 border-b-solid rounded-t-2xl border-b-transparent">
                <div class="flex justify-between items-center">
                    <h6 class="font-bold">Reservations for {{ event.name }}</h6>
                    <a href="{{ path('event_list') }}" class="inline-block px-6 py-3 font-bold text-center text-white uppercase align-middle transition-all bg-transparent border-0 rounded-lg cursor-pointer leading-pro text-xs ease-soft-in shadow-soft-md bg-150 bg-x-25 bg-gradient-to-tl from-gray-900 to-slate-800 hover:shadow-soft-2xl hover:scale-102">Back to List</a>
                </div>
            </div>
            
            <div class="flex-auto px-0 pt-0 pb-2">
                <div class="p-0 overflow-x-auto">
                    <table class="items-center w-full mb-0 align-top border-gray-200 text-slate-500">
                        <thead class="align-bottom">
                            <tr>
                                <th class="px-6 py-3 font-bold text-left uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">User</th>
                                <th class="px-6 py-3 pl-2 font-bold text-left uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Reserved At</th>
                                <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Status</th>
                                <th class="px-6 py-3 font-semibold capitalize align-middle bg-transparent border-b border-gray-200 border-b-solid shadow-none tracking-none whitespace-nowrap text-slate-400 opacity-70">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in event.reservations %}
                            <tr>
                                <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <div class="flex flex-col justify-center px-2 py-1">
                                        {# Assuming Users entity has email or username #}
                                        <h6 class="mb-0 text-sm leading-normal">{{ reservation.user.email ?? reservation.user.username ?? 'Unknown User' }}</h6>
                                        <p class="mb-0 text-xs leading-tight text-slate-400">ID: {{ reservation.user.id }}</p>
                                    </div>
                                </td>
                                <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <p class="mb-0 text-xs font-semibold leading-tight">{{ reservation.reservedAt|date('Y-m-d H:i') }}</p>
                                </td>
                                <td class="p-2 text-center align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    <span class="bg-gradient-to-tl {{ reservation.status == 'validated' ? 'from-green-600 to-lime-400' : (reservation.status == 'cancelled' ? 'from-red-600 to-rose-400' : 'from-slate-600 to-slate-300') }} px-2.5 text-xs rounded-1.8 py-1.4 inline-block whitespace-nowrap text-center align-baseline font-bold uppercase leading-none text-white">{{ reservation.status }}</span>
                                </td>
                                <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                    {% if reservation.status == 'pending' %}
                                        <a href="{{ path('reservation_update', {'id': reservation.id, 'status': 'validated'}) }}" class="inline-block px-4 py-2 mb-0 font-bold text-center text-white uppercase align-middle transition-all bg-transparent border-0 rounded-lg shadow-none cursor-pointer leading-pro text-xs ease-soft-in bg-150 bg-gradient-to-tl from-green-600 to-lime-400 hover:scale-102 active:opacity-85 hover:shadow-soft-xs mr-2">
                                            Validate
                                        </a>
                                        <a href="{{ path('reservation_update', {'id': reservation.id, 'status': 'cancelled'}) }}" class="inline-block px-4 py-2 mb-0 font-bold text-center text-white uppercase align-middle transition-all bg-transparent border-0 rounded-lg shadow-none cursor-pointer leading-pro text-xs ease-soft-in bg-150 bg-gradient-to-tl from-red-600 to-rose-400 hover:scale-102 active:opacity-85 hover:shadow-soft-xs">
                                            Cancel
                                        </a>
                                    {% else %}
                                        <span class="text-xs text-slate-400">Action taken</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center p-4">No reservations found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}