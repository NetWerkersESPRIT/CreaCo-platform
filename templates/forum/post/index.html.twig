{% extends 'base.html.twig' %}

{% block title %}Forum - CreaCo{% endblock %}
{% block page_title %}Forum{% endblock %}
{% block page_subtitle %}Fil d'actualité{% endblock %}

{% block body %}
<div class="flex flex-wrap -mx-3 justify-center">
    <!-- Main Feed Section (Centered & Wide) -->
    <div class="w-full max-w-full px-3 lg:w-10/12 mx-auto">
        
        <!-- Forum Header -->
        <div class="relative flex flex-row items-center justify-between p-4 bg-white shadow-soft-xl rounded-2xl mb-6">
            <h6 class="mb-0 font-bold ml-2 text-slate-700">Discussions Récentes</h6>
            <a href="{{ path('app_post_new') }}" class="inline-block px-6 py-2.5 font-bold text-center text-white uppercase align-middle transition-all bg-transparent border-0 rounded-lg cursor-pointer shadow-soft-md bg-150 bg-x-25 leading-pro text-xs ease-soft-in tracking-tight-soft bg-gradient-to-tl from-purple-700 to-pink-500 hover:scale-102 hover:shadow-soft-xs active:opacity-85">
                <i class="fas fa-plus mr-1 text-xs"></i> Créer un Post
            </a>
        </div>

        {% for post in posts %}
            <div class="relative flex flex-col min-w-0 break-words bg-white border-0 shadow-soft-xl rounded-2xl bg-clip-border mb-6 hover:shadow-soft-2xl transition-all duration-300">
                <!-- Header Style -->
                <div class="p-4 pb-0">
                    <div class="flex items-center">
                        <div class="avatar avatar-xs me-2">
                            <img src="https://ui-avatars.com/api/?name={{ post.user ? post.user.username : 'User' }}&background=f5f5f5&color=cb0c9f" class="w-10 h-10 rounded-full border border-gray-100 shadow-soft-xs" alt="user1">
                        </div>
                        <div class="flex flex-col ml-3">
                            <span class="text-xs font-bold text-slate-700">{{ post.user ? post.user.username : 'Anonyme' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Content Style -->
                <div class="p-4 pt-2">
                    <a href="{{ path('app_post_show', {'id': post.id}) }}" class="block">
                        <h5 class="font-bold text-slate-800 mb-2 leading-tight hover:text-purple-700 transition-colors">{{ post.title }}</h5>
                    </a>
                    <div class="text-sm leading-normal text-slate-600 mb-4 whitespace-pre-wrap">
                        {{ post.content }}
                    </div>
                    
                    {% if post.imageName %}
                        <div class="mb-3 overflow-hidden rounded-xl border border-gray-100">
                            <img src="{{ asset('uploads/' ~ post.imageName) }}" class="w-full h-auto" alt="post image">
                        </div>
                    {% endif %}

                    {% if post.pdfName %}
                        <div class="mb-3 p-3 bg-gray-50 rounded-xl border border-dashed border-gray-200 flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="bg-red-100 p-1.5 rounded-lg mr-2">
                                    <i class="fas fa-file-pdf text-red-600 text-sm"></i>
                                </div>
                                <span class="text-xs font-bold text-slate-700">Document PDF</span>
                            </div>
                            <a href="{{ asset('uploads/' ~ post.pdfName) }}" target="_blank" class="text-xs font-bold text-white bg-gradient-to-tl from-purple-700 to-pink-500 px-4 py-2 rounded-lg shadow-soft-md hover:scale-102 transition-all uppercase">
                                <i class="fas fa-eye mr-1"></i> Ouvrir
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- Interaction Bar -->
                <div class="p-4 pt-0 flex flex-wrap items-center gap-2">
                    <!-- Like Button -->
                    <form action="{{ path('app_post_like', {'id': post.id}) }}" method="POST" class="mb-0">
                        <button type="submit" class="bg-gray-100 rounded-full flex items-center px-4 py-2 text-slate-600 hover:bg-gray-200 transition-all border-0 shadow-none cursor-pointer">
                            <i class="fas fa-thumbs-up text-xs text-purple-700 mr-2"></i>
                            <span class="text-xs font-bold">{{ post.likes }}</span>
                        </button>
                    </form>

                    <!-- Comment -->
                    <a href="{{ path('app_post_show', {'id': post.id}) }}" class="bg-gray-100 rounded-full flex items-center px-4 py-2 text-slate-600 hover:bg-gray-200 transition-all text-decoration-none border-0">
                        <i class="fas fa-comment text-xs text-slate-500 mr-2"></i>
                        <span class="text-xs font-bold">{{ post.comments|length }} Commentaires</span>
                    </a>

                    {% set canManagePost = app.user and post.user == app.user %}
                    {% if canManagePost %}
                        <!-- Edit Button -->
                        <a href="{{ path('app_post_edit', {'id': post.id}) }}" class="bg-gray-100 rounded-full flex items-center px-4 py-2 text-slate-600 hover:bg-purple-100 hover:text-purple-700 transition-all text-decoration-none border-0">
                            <i class="fas fa-edit text-xs mr-2"></i>
                            <span class="text-xs font-bold">Modifier</span>
                        </a>

                        <!-- Delete Button -->
                        <form action="{{ path('app_post_delete', {'id': post.id}) }}" method="POST" class="mb-0" onsubmit="return confirm('Supprimer ce post ?')">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ post.id) }}">
                            <button type="submit" class="bg-gray-100 rounded-full flex items-center px-4 py-2 text-slate-600 hover:bg-red-100 hover:text-red-700 transition-all border-0 shadow-none cursor-pointer">
                                <i class="fas fa-trash text-xs mr-2"></i>
                                <span class="text-xs font-bold">Supprimer</span>
                            </button>
                        </form>
                    {% endif %}

                    <!-- Share -->
                    <button class="bg-gray-100 rounded-full flex items-center px-4 py-2 text-slate-600 hover:bg-gray-200 transition-all border-0 shadow-none cursor-pointer">
                        <i class="fas fa-share text-xs text-slate-500 mr-2"></i>
                        <span class="text-xs font-bold">Partager</span>
                    </button>
                </div>
            </div>
        {% else %}
            <div class="relative flex flex-col min-w-0 break-words bg-white shadow-soft-xl rounded-2xl p-10 text-center">
                <i class="fas fa-ghost text-5xl text-slate-200 mb-4"></i>
                <h6 class="mb-0">Rien ici pour le moment.</h6>
                <p class="text-sm">Lancez la discussion !</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
