{% extends 'base.html.twig' %}

{% block title %}Preview Post -
	{{ post.title }}
{% endblock %}
{% block page_title %}Post Preview
{% endblock %}
{% block breadcrumb %}Admin / Pending /
	{{ post.title }}
{% endblock %}

{% block body %}
	<div class="flex flex-wrap -mx-3 justify-center">
		<div
			class="w-full max-w-full px-3 lg:w-10/12">
			<!-- Main Content Card -->
			<div class="relative flex flex-col min-w-0 break-words bg-white border-0 shadow-soft-xl rounded-2xl bg-clip-border mb-6">
				<div
					class="p-6">
					<!-- Header: Title and Meta -->
					<div class="flex flex-wrap items-center justify-between mb-6 gap-4">
						<div class="flex-1">
							<h3 class="font-bold text-slate-700 mb-1">{{ post.title }}</h3>
							<div class="flex flex-wrap items-center gap-4 text-xs font-bold uppercase tracking-wider text-slate-400">
								<span class="flex items-center gap-1">
									<i class="fas fa-user-circle"></i>
									{{ post.user ? post.user.username : 'Anonymous' }}
								</span>
								<span class="flex items-center gap-1">
									<i class="fas fa-calendar-alt"></i>
									{{ post.createdAt|date('F j, Y, g:i a') }}
								</span>
								<span class="px-2 py-0.5 bg-orange-100 text-orange-700 rounded-lg text-[10px]">
									{{ post.status|upper }}
								</span>
							</div>
						</div>
						<div class="flex items-center gap-3">
							<a href="{{ path('admin_post_pending') }}" class="px-6 py-2.5 text-xs font-bold text-slate-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-all uppercase border-0 cursor-pointer">
								Back to List
							</a>
						</div>
					</div>

					<!-- Content Body -->
					<div class="bg-gray-50 rounded-2xl p-6 mb-6 border border-gray-100">
						<div class="text-slate-600 leading-relaxed whitespace-pre-wrap">
							{{ post.content }}
						</div>
					</div>

					<!-- Attachments -->
					<div
						class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
						<!-- Image Preview -->
						{% if post.imageName %}
							<div class="flex flex-col gap-2">
								<label class="text-xs font-bold text-slate-400 uppercase">Image Attachment</label>
								<div class="rounded-2xl overflow-hidden border border-gray-100 shadow-soft-xs bg-white p-2">
									<img src="{{ asset('uploads/' ~ post.imageName) }}" class="w-full h-auto rounded-xl" alt="Post content">
								</div>
							</div>
						{% endif %}

						<!-- PDF Preview -->
						{% if post.pdfName %}
							<div class="flex flex-col gap-2">
								<label class="text-xs font-bold text-slate-400 uppercase">PDF Attachment</label>
								<div class="rounded-2xl border border-dashed border-gray-200 bg-white p-6 flex flex-col items-center justify-center text-center">
									<i class="fas fa-file-pdf text-red-500 text-4xl mb-3"></i>
									<span class="text-sm font-bold text-slate-700 mb-4">Document.pdf</span>
									<a href="{{ asset('uploads/' ~ post.pdfName) }}" target="_blank" class="w-full py-2.5 text-xs font-bold text-white bg-gradient-to-tl from-red-600 to-rose-400 rounded-lg shadow-soft-md hover:scale-102 transition-all uppercase">
										<i class="fas fa-eye mr-2"></i>
										View PDF
									</a>
								</div>
							</div>
						{% endif %}
					</div>

					<!-- Footer: Moderation Actions -->
					<div class="pt-6 border-t border-gray-100 flex flex-wrap items-center justify-end gap-4">
						<button type="button" onclick="openRefusalModal()" class="px-8 py-3 text-xs font-bold text-white bg-gradient-to-tl from-red-600 to-rose-400 rounded-xl shadow-soft-md hover:scale-105 transition-all uppercase border-0 cursor-pointer">
							<i class="fas fa-times-circle mr-2"></i>
							Refuse Post
						</button>
						<form action="{{ path('admin_post_approve', {'id': post.id}) }}" method="POST" class="m-0">
							<button type="submit" class="px-8 py-3 text-xs font-bold text-white bg-gradient-to-tl from-green-600 to-lime-400 rounded-xl shadow-soft-md hover:scale-105 transition-all uppercase border-0 cursor-pointer">
								<i class="fas fa-check-circle mr-2"></i>
								Approve Post
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Refusal Modal -->
	<div id="refusalModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
		<div class="bg-white rounded-3xl shadow-soft-2xl w-full max-w-lg overflow-hidden transform transition-all animate-scale-in">
			<div class="relative p-6">
				<div class="flex items-center justify-between mb-6">
					<div>
						<h5 class="font-bold text-slate-700 mb-1">Refuse Discussion</h5>
						<p class="text-xs text-slate-400 font-bold uppercase tracking-wider">Provide a reason to the user</p>
					</div>
					<button type="button" onclick="closeRefusalModal()" class="w-8 h-8 flex items-center justify-center text-slate-400 hover:text-slate-600 hover:bg-gray-100 rounded-full transition-all border-0 bg-transparent cursor-pointer">
						<i class="fas fa-times"></i>
					</button>
				</div>

				<form action="{{ path('admin_post_refuse', {'id': post.id}) }}" method="POST">
					<div class="mb-6">
						<textarea name="refusalReason" class="w-full px-4 py-4 text-sm border border-gray-200 rounded-2xl focus:ring-4 focus:ring-purple-500/10 focus:border-purple-500 outline-none transition-all placeholder:text-slate-300 min-h-[150px] resize-none" required placeholder="Ex: This post contains inappropriate language or is off-topic..."></textarea>
					</div>
					<div class="flex flex-wrap items-center justify-end gap-3">
						<button type="button" onclick="closeRefusalModal()" class="px-6 py-2.5 text-xs font-bold text-slate-500 uppercase rounded-xl hover:bg-gray-50 transition-all border-0 bg-transparent cursor-pointer">
							Cancel
						</button>
						<button type="submit" class="px-8 py-2.5 text-xs font-bold text-white uppercase bg-gradient-to-tl from-red-600 to-rose-400 rounded-xl shadow-soft-md hover:scale-102 transition-all border-0 cursor-pointer">
							Confirm Refusal
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script>
		function openRefusalModal() {
const modal = document.getElementById('refusalModal');
modal.classList.remove('hidden');
modal.classList.add('flex');
document.body.style.overflow = 'hidden';
}

function closeRefusalModal() {
const modal = document.getElementById('refusalModal');
modal.classList.add('hidden');
modal.classList.remove('flex');
document.body.style.overflow = 'auto';
}

// Close on outside click
window.onclick = function (event) {
const modal = document.getElementById('refusalModal');
if (event.target === modal) {
closeRefusalModal();
}
}
	</script>

	<style>
		@keyframes fadeIn {
			from {
				opacity: 0;
			}
			to {
				opacity: 1;
			}
		}
		@keyframes scaleIn {
			from {
				opacity: 0;
				transform: scale(0.95);
			}
			to {
				opacity: 1;
				transform: scale(1);
			}
		}
		.animate-fade-in {
			animation: fadeIn 0.2s ease-out forwards;
		}
		.animate-scale-in {
			animation: scaleIn 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
		}
	</style>
{% endblock %}
