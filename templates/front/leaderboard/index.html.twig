{% extends 'base.html.twig' %}

{% block title %}Leaderboard | CreaCo{% endblock %}
{% block page_title %}Leaderboard{% endblock %}

{% block body %}
<div class="w-full px-6 py-6 mx-auto">
    
    <!-- Page Header -->
    <div class="flex flex-wrap -mx-3 mb-6">
        <div class="w-full max-w-full px-3">
            <div class="relative flex flex-col min-w-0 break-words bg-gradient-to-tl from-purple-700 to-pink-500 shadow-soft-xl rounded-2xl bg-clip-border">
                <div class="p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="mb-2 font-bold text-white">üèÜ Leaderboard</h3>
                            <p class="mb-0 opacity-80">Compete with other learners and climb to the top!</p>
                        </div>
                        <div class="text-right">
                            <i class="fas fa-trophy text-6xl opacity-20"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Stats Card -->
    {% if currentUser and userStats %}
    <div class="flex flex-wrap -mx-3 mb-6">
        <div class="w-full max-w-full px-3">
            <div class="relative flex flex-col min-w-0 break-words bg-white shadow-soft-xl rounded-2xl bg-clip-border">
                <div class="p-6">
                    <h6 class="mb-4 font-bold">Your Statistics</h6>
                    <div class="flex flex-wrap -mx-3">
                        <div class="w-full max-w-full px-3 mb-4 sm:w-1/2 lg:w-1/4">
                            <div class="text-center p-4 bg-gradient-to-tl from-purple-700 to-pink-500 rounded-xl text-white">
                                <i class="fas fa-star text-3xl mb-2"></i>
                                <h4 class="mb-0 font-bold">{{ userStats.points }}</h4>
                                <p class="mb-0 text-xs opacity-80">Total Points</p>
                            </div>
                        </div>
                        <div class="w-full max-w-full px-3 mb-4 sm:w-1/2 lg:w-1/4">
                            <div class="text-center p-4 bg-gradient-to-tl from-blue-600 to-blue-400 rounded-xl text-white">
                                <i class="fas fa-trophy text-3xl mb-2"></i>
                                <h4 class="mb-0 font-bold">{{ userRank ?? 'N/A' }}</h4>
                                <p class="mb-0 text-xs opacity-80">Your Rank</p>
                            </div>
                        </div>
                        <div class="w-full max-w-full px-3 mb-4 sm:w-1/2 lg:w-1/4">
                            <div class="text-center p-4 bg-gradient-to-tl from-green-600 to-green-400 rounded-xl text-white">
                                <i class="fas fa-check-circle text-3xl mb-2"></i>
                                <h4 class="mb-0 font-bold">{{ userStats.completed_courses }}</h4>
                                <p class="mb-0 text-xs opacity-80">Completed Courses</p>
                            </div>
                        </div>
                        <div class="w-full max-w-full px-3 mb-4 sm:w-1/2 lg:w-1/4">
                            <div class="text-center p-4 bg-gradient-to-tl from-orange-600 to-orange-400 rounded-xl text-white">
                                <i class="fas fa-book-open text-3xl mb-2"></i>
                                <h4 class="mb-0 font-bold">{{ userStats.total_resources_opened }}</h4>
                                <p class="mb-0 text-xs opacity-80">Resources Opened</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Leaderboard Table -->
    <div class="flex flex-wrap -mx-3">
        <div class="w-full max-w-full px-3">
            <div class="relative flex flex-col min-w-0 break-words bg-white shadow-soft-xl rounded-2xl bg-clip-border">
                <div class="p-6 pb-0 mb-0 bg-white border-b-0 border-b-solid rounded-t-2xl border-b-transparent">
                    <h6 class="font-bold">Top Learners</h6>
                    <p class="leading-normal text-sm">See who's leading the pack!</p>
                </div>
                <div class="flex-auto px-0 pt-0 pb-2">
                    <div class="p-0 overflow-x-auto">
                        <table class="items-center w-full mb-0 align-top border-gray-200 text-slate-500">
                            <thead class="align-bottom">
                                <tr>
                                    <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Rank</th>
                                    <th class="px-6 py-3 font-bold text-left uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">User</th>
                                    <th class="px-6 py-3 font-bold text-center uppercase align-middle bg-transparent border-b border-gray-200 shadow-none text-xxs border-b-solid tracking-none whitespace-nowrap text-slate-400 opacity-70">Points</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for entry in leaderboard %}
                                <tr class="{{ currentUser and entry.id == currentUser.id ? 'bg-purple-50' : '' }}">
                                    <td class="p-2 text-center align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                        <div class="flex items-center justify-center">
                                            {% if loop.index == 1 %}
                                                <span class="text-2xl">ü•á</span>
                                            {% elseif loop.index == 2 %}
                                                <span class="text-2xl">ü•à</span>
                                            {% elseif loop.index == 3 %}
                                                <span class="text-2xl">ü•â</span>
                                            {% else %}
                                                <span class="text-sm font-bold text-slate-600">#{{ loop.index }}</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                        <div class="flex px-2 py-1">
                                            <div class="flex items-center justify-center w-10 h-10 mr-4 text-white rounded-xl bg-gradient-to-tl from-purple-700 to-pink-500">
                                                <span class="font-bold">{{ entry.username|slice(0, 1)|upper }}</span>
                                            </div>
                                            <div class="flex flex-col justify-center">
                                                <h6 class="mb-0 text-sm leading-normal font-bold">
                                                    {{ entry.username }}
                                                    {% if currentUser and entry.id == currentUser.id %}
                                                        <span class="ml-2 text-xs text-purple-600">(You)</span>
                                                    {% endif %}
                                                </h6>
                                                <p class="mb-0 text-xs leading-tight text-slate-400">{{ entry.email }}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="p-2 text-center align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                                        <span class="inline-block px-4 py-2 font-bold text-center uppercase align-middle transition-all bg-gradient-to-tl from-purple-700 to-pink-500 text-white rounded-lg text-xs">
                                            <i class="fas fa-star mr-1"></i>
                                            {{ entry.points }} pts
                                        </span>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="3" class="p-6 text-center">
                                        <p class="text-slate-500">No data available yet. Start learning to appear on the leaderboard!</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

