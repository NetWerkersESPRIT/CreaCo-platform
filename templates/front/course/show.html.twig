{% extends 'base.html.twig' %}

{% block title %}CreaCo -
	{{ course.titre }}
{% endblock %}

{% block body %}
	<div
		class="w-full px-6 py-6 mx-auto">

		<!-- Breadcrumbs -->
		<nav class="relative flex flex-wrap items-center justify-between px-0 py-2 mx-6 transition-all shadow-none duration-250 ease-soft-in rounded-2xl lg:flex-nowrap lg:justify-start">
			<div class="flex items-center justify-between w-full px-4 py-1 mx-auto flex-wrap-inherit">
				<nav>
					<ol class="flex flex-wrap pt-1 mr-12 bg-transparent rounded-lg sm:mr-16">
						<li class="text-sm leading-normal">
							<a class="opacity-50 text-slate-700" href="{{ path('app_front_home') }}">Courses</a>
						</li>
						<li class="text-sm pl-2 capitalize leading-normal text-slate-700 before:float-left before:pr-2 before:text-gray-600 before:content-['/']">
							{% if course.categorie %}
								<a class="opacity-50 text-slate-700" href="{{ path('app_front_category', {'id': course.categorie.id}) }}">{{ course.categorie.nom }}</a>
							{% else %}
								-
							{% endif %}
						</li>
						<li class="text-sm pl-2 capitalize leading-normal text-slate-700 before:float-left before:pr-2 before:text-gray-600 before:content-['/']" aria-current="page">{{ course.titre }}</li>
					</ol>
					<h6 class="mb-0 font-bold capitalize">{{ course.titre }}</h6>
				</nav>
			</div>
		</nav>

		<!-- Course Header Card -->
		<div class="flex flex-wrap -mx-3 mb-6">
			<div class="w-full max-w-full px-3">
				<div class="relative flex flex-col min-w-0 break-words bg-white shadow-soft-xl rounded-2xl bg-clip-border overflow-hidden">
					<div class="relative h-64 lg:h-96 w-full">
						{% if course.image %}
							<img src="{{ course.image }}" alt="{{ course.titre }}" class="w-full h-full object-cover">
						{% else %}
							<div class="w-full h-full flex items-center justify-center bg-gradient-to-tl from-gray-900 to-slate-800 text-white">
								<i class="fas fa-graduation-cap text-6xl"></i>
							</div>
						{% endif %}
						<div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
						<div class="absolute bottom-0 left-0 p-6 lg:p-12 text-white">
							<span class="mb-2 py-1 px-3 rounded-lg bg-white/20 backdrop-blur-sm text-xs font-bold uppercase">{{ course.categorie ? course.categorie.nom : 'Course' }}</span>
							<h1 class="text-3xl lg:text-5xl font-bold mb-2">{{ course.titre }}</h1>
							<div class="flex items-center gap-4 text-sm font-medium opacity-80">
								<span>
									<i class="fas fa-calendar-alt mr-1"></i>
									{{ course.dateDeCreation ? course.dateDeCreation|date('d F Y') : '-' }}</span>
							</div>
						</div>
					</div>
					<div class="p-6">
						<h6 class="mb-2">About this course</h6>
						<p class="leading-relaxed text-slate-600 mb-0">
							{{ course.description|nl2br }}
						</p>
					</div>
				</div>
			</div>
		</div>

		<!-- Progress Card -->
		{% if progress %}
		<div class="flex flex-wrap -mx-3 mb-6">
			<div class="w-full max-w-full px-3">
				<div class="relative flex flex-col min-w-0 break-words bg-gradient-to-tl from-purple-700 to-pink-500 shadow-soft-xl rounded-2xl bg-clip-border">
					<div class="p-6 text-white">
						<div class="flex items-center justify-between mb-4">
							<div>
								<h6 class="mb-1 text-white font-bold">Your Progress</h6>
								<p class="mb-0 text-sm opacity-80">Track your learning journey</p>
							</div>
							<div class="text-right">
								<h3 class="mb-0 font-bold text-white">{{ progress.progress_percentage|number_format(0) }}%</h3>
								<p class="mb-0 text-xs opacity-80">Complete</p>
							</div>
						</div>

						<!-- Progress Bar -->
						<div class="w-full bg-white/20 rounded-full h-3 mb-4">
							<div class="bg-white h-3 rounded-full transition-all duration-500" style="width: {{ progress.progress_percentage }}%"></div>
						</div>

						<!-- Stats -->
						<div class="flex items-center justify-between text-sm">
							<div class="flex items-center gap-2">
								<i class="fas fa-book-open"></i>
								<span>{{ progress.opened_resources }} / {{ progress.total_resources }} resources opened</span>
							</div>
							{% if progress.is_completed %}
								<div class="flex items-center gap-2 bg-white/20 px-3 py-1 rounded-lg">
									<i class="fas fa-check-circle"></i>
									<span class="font-semibold">Completed!</span>
								</div>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>
		{% endif %}

		<!-- Resources Title -->
		<div class="flex flex-wrap -mx-3 mb-4">
			<div class="w-full max-w-full px-3">
				<h5 class="font-bold">Course Resources
					<span class="ml-2 text-sm font-semibold text-slate-500 bg-white rounded-lg px-2 py-1 shadow-soft-xs">{{ ressources|length }}</span>
				</h5>
			</div>
		</div>

		<!-- Resources Grid -->
		<div class="flex flex-wrap -mx-3">
			{% for ressource in ressources %}
				<div class="w-full max-w-full px-3 mb-6 sm:w-1/2 lg:w-1/3 xl:w-1/4">
					<div
						class="relative flex flex-col min-w-0 break-words bg-white shadow-soft-xl rounded-2xl bg-clip-border h-full hover:shadow-soft-2xl transition-all duration-300">

						{# Define detection logic #}
						{% set is_youtube = (ressource.type|upper == 'VIDEO' and ('youtube.com' in ressource.url or 'youtu.be' in ressource.url)) %}
						{% set video_id = '' %}

						{% if is_youtube %}
							{% if 'v=' in ressource.url %}
								{% set video_id = ressource.url|split('v=')|last|split('&')|first %}
							{% elseif 'youtu.be' in ressource.url %}
								{% set video_id = ressource.url|split('/')|last %}
							{% endif %}

							{# VIDEO CARD LAYOUT #}
							<div class="w-full relative overflow-hidden rounded-t-2xl bg-black" style="padding-top: 56.25%;">
								<iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/{{ video_id }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
							</div>
							<div class="flex-auto p-4">
								<div class="flex justify-between items-start mb-2">
									<span class="badge rounded-pill bg-gradient-to-tl from-red-600 to-rose-400 text-white text-xxs tracking-widest font-bold">VIDEO</span>
									<span class="text-xs text-slate-400">{{ ressource.dateDeCreation ? ressource.dateDeCreation|date('d/m/Y') : '' }}</span>
								</div>
								<h6 class="mb-2 font-bold text-slate-700 leading-tight">{{ ressource.nom }}</h6>
								<a href="{{ path('app_ressource_view', {'id': ressource.id}) }}" class="w-full inline-block px-4 py-2 font-bold text-center uppercase transition-all bg-gradient-to-tl from-purple-700 to-pink-500 text-white rounded-lg cursor-pointer leading-pro text-xs ease-soft-in shadow-soft-md hover:scale-102 active:opacity-85">
									<i class="fas fa-external-link-alt mr-1"></i>
									Open Resource
								</a>
							</div>

						{% else %}
							{# STANDARD CARD LAYOUT #}
							<div class="flex-auto p-4">
								<div class="flex items-start justify-between mb-4">
									<div class="inline-flex items-center justify-center w-12 h-12 text-white rounded-xl shadow-soft-2xl
																																	                                        {% if ressource.type|upper == 'PDF' %}bg-gradient-to-tl from-red-600 to-rose-400
																																	                                        {% elseif ressource.type|upper == 'VIDEO' %}bg-gradient-to-tl from-red-500 to-orange-400
																																	                                        {% elseif ressource.type|upper == 'IMAGE' %}bg-gradient-to-tl from-purple-700 to-pink-500
																																	                                        {% else %}bg-gradient-to-tl from-slate-600 to-slate-300{% endif %}">
										{% if ressource.type|upper == 'PDF' %}
											<i class="fas fa-file-pdf text-lg"></i>
										{% elseif ressource.type|upper == 'VIDEO' %}
											<i class="fas fa-video text-lg"></i>
										{% elseif ressource.type|upper == 'IMAGE' %}
											<i class="fas fa-image text-lg"></i>
										{% else %}
											<i class="fas fa-file text-lg"></i>
										{% endif %}
									</div>
									<span class="badge rounded-pill bg-light text-dark text-xs font-bold">{{ ressource.type }}</span>
								</div>

								<h6 class="mb-2 font-bold text-slate-700 leading-tight">{{ ressource.nom }}</h6>
								<p class="text-xs text-slate-500 mb-4">Added on
									{{ ressource.dateDeCreation ? ressource.dateDeCreation|date('d/m/Y') : '-' }}</p>

								<a href="{{ path('app_ressource_view', {'id': ressource.id}) }}" class="w-full inline-block px-4 py-2 mb-2 font-bold text-center uppercase transition-all bg-gradient-to-tl from-purple-700 to-pink-500 text-white rounded-lg cursor-pointer leading-pro text-xs ease-soft-in shadow-soft-md hover:scale-102 active:opacity-85">
									<i class="fas fa-external-link-alt mr-1"></i>
									Open Resource
								</a>

								{% if ressource.url %}
								<a href="{{ ressource.url }}" target="_blank" download class="w-full inline-block px-4 py-2 font-bold text-center uppercase transition-all bg-transparent border border-solid rounded-lg cursor-pointer leading-pro text-xs ease-soft-in shadow-none tracking-tight-rem hover:scale-102 active:opacity-85 border-slate-700 text-slate-700 hover:bg-slate-700 hover:text-white">
									<i class="fas fa-download mr-1"></i>
									Download
								</a>
								{% endif %}
							</div>
						{% endif %}

					</div>
				</div>
			{% else %}
				<div class="w-full max-w-full px-3">
					<div class="text-center p-12 bg-white shadow-soft-xl rounded-2xl border-2 border-dashed border-gray-200">
						<i class="ni ni-folder-17 text-4xl text-slate-300 mb-4"></i>
						<p class="text-lg font-semibold text-slate-500">No resources available for this course.</p>
					</div>
				</div>
			{% endfor %}
		</div>
	</div>
{% endblock %}
